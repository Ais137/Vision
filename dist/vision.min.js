!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).vision={})}(this,(function(t){"use strict";let e=class t{constructor(...t){this.v=t.length>0?[...t]:[0,0]}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}set x(t){this.v[0]=t}set y(t){this.v[1]=t}set z(t){this.v[2]=t}static v(...e){return new t(...e)}static V(...e){return new t(...e)}static ones(e=2){return new t(...Array(e).fill(1))}static zeros(e=2){return new t(...Array(e).fill(0))}static random(e=[],s=!1){let i=[],r=0;for(let t=0,h=e.length;t<h;t++)r=Math.random()*(e[t][1]-e[t][0])+e[t][0],s?i.push(parseInt(r)):i.push(r);return new t(...i)}static rcv(e,s=null){let i=Math.random()*(2*Math.PI),r=null==s?Math.random()*e:Math.random()*(s-e)+e;return new t(Math.cos(i)*r,Math.sin(i)*r)}add(t){for(let e=0,s=this.v.length;e<s;e++)this.v[e]+=t.v[e]||0;return this}static add(...e){let s=t.zeros(e[0].dim());for(let t=0,i=e.length;t<i;t++)s.dim()<e[t].dim()&&s.dim(e[t].dim()),s.add(e[t]);return s}mult(t){for(let e=0,s=this.v.length;e<s;e++)this.v[e]*=t;return this}static mult(t,e){return t.clone().mult(e)}sub(t){for(let e=0,s=this.v.length;e<s;e++)this.v[e]-=t.v[e]||0;return this}static sub(...t){let e=t[0].clone();for(let s=1,i=t.length;s<i;s++)e.sub(t[s]);return e}dot(t){let e=0;for(let s=0,i=this.v.length;s<i;s++)e+=this.v[s]*(t.v[s]||0);return e}inner(t){return this.dot(t)}static LC(e,s){let i=t.zeros(e[0].dim());for(let t=0,r=e.length;t<r;t++)i.add(e[t].clone().mult(s[t]));return i}LM(t){let e=[];for(let s=0,i=t.length;s<i;s++){let i=0;for(let e=0,r=t[s].length;e<r;e++)i+=t[s][e]*(this.v[e]||0);e.push(i)}return this.v=e,this}static LM(t,e){return t.clone().map(e)}lerp(t,e){return e>0&&e<1?t.clone().sub(this).mult(e).add(this):e<=0?this.clone():t.clone()}static lerp(t,e,s){return t.lerp(e,s)}rotate(t,e=!1){t=e?Math.PI/180*t:t;let s=Math.cos(t),i=Math.sin(t),r=this.v[0]*s-this.v[1]*i,h=this.v[0]*i+this.v[1]*s;return this.v[0]=r,this.v[1]=h,this}static rotate(t,e){return t.clone().rotate(e)}dim(t=null){if(null!=t){let e=[],s=parseInt(t);for(let t=0;t<s;t++)e[t]=this.v[t]||0;return this.v=e,this}return this.v.length}norm(t=null){let e=0;for(let t=0,s=this.v.length;t<s;t++)e+=this.v[t]*this.v[t];let s=Math.sqrt(e);return null!=t&&0!=s&&this.mult(t/s),null==t?s:this}normalization(){let t=this.norm();return 0!=t&&this.mult(1/t),this}limit(t,e=null){let s,i,r=this.norm();return null==e?(i=0,s=Math.abs(t)):(i=Math.abs(t),s=Math.abs(e)),!(r>=i&&r<=s)&&this.norm(r>s?s:i),this}clone(){return new t(...this.v)}copy(){return this.clone()}dist(t=null){if(null==t)return this.norm();{let e=0,s=t.v;for(let t=0,i=this.v.length;t<i;t++)e+=(this.v[t]-s[t])*(this.v[t]-s[t]);return Math.sqrt(e)}}static dist(t,e){return t.dist(e)}rad(t=null){let e=this.v[0],s=this.v[1],i=Math.atan(s/e);return i=e>=0?s>=0?i:2*Math.PI+i:Math.PI+i,t?i-t.rad():i}static rad(t,e){return t.rad(e)}toint(){for(let t=0,e=this.v.length;t<e;t++)this.v[t]=parseInt(this.v[t])}in(t=[]){for(let e=0,s=t.length;e<s;e++)if(!(this.v[e]>=t[e][0]&&this.v[e]<=t[e][1]))return!1;return!0}static in(t,e){return t.in(e)}static vpoints(e){let s=[];for(let i=0,r=e.length;i<r;i++)s.push(new t(...e[i]));return s}};var s=Object.freeze({__proto__:null,Vector:e});class i{constructor(t,s){this.p=t||new e(0,0),this.v=s||new e(0,0)}action(){return this.p.add(this.v)}isEnd(){return!1}}class r extends i{static RuleSet={alignment:(t,s)=>{let i=new e(0,0);for(let t=0,e=s.length;t<e;t++)i.add(s[t].v);return i.mult(1/s.length)},separation:(t,s)=>{let i=new e(0,0);for(let r=0,h=s.length;r<h;r++){let h=t.p.dist(s[r].p);i.add(e.sub(t.p,s[r].p).norm(1/h*h))}return i},cohesion:(t,s)=>{let i=new e(0,0);for(let t=0,e=s.length;t<e;t++)i.add(s[t].p);return i.mult(1/s.length),e.sub(i,t.p)}};constructor(t,s,i,h){super(t,s),this.R=i,this.K=h,this.visual_field=(t,e)=>e,this.rules=[r.RuleSet.alignment,r.RuleSet.separation,r.RuleSet.cohesion],this.acc=new e(0,0)}rules_action(t){if(0==t.length)return;t=this.visual_field(this,t);let s=[];for(let e=0,i=this.rules.length;e<i;e++)s[e]=this.rules[e](this,t);this.acc.add(e.LC(s,this.K))}action(){return this.p.add(this.v.add(this.acc)),this.acc=new e(0,0),this.p}}var h=Object.freeze({__proto__:null,Boid:r,boids_middlewares:function(t){return function(e){t.build(e);for(let s=e.length;s--;)e[s].rules_action(t.near(e[s],e[s].R))}}});class n{constructor(t,e){this.r=t,this.i=e}add(t){return this.r+=t.r,this.i+=t.i,this}mult(t){let e=this.r,s=this.i,i=t.r,r=t.i;return this.r=e*i-s*r,this.i=s*i+e*r,this}norm(){return Math.sqrt(this.r*this.r+this.i*this.i)}}class o{constructor(t,e){this.vect=e||function(t){return t},this.ps=t,this.IS_LOOP_BORDER=!1}build(t=null){return this.ps=t||this.ps,this}near(t,e){return[]}k_near(t,e){return[]}nps(t,e="dist"){let s=("dist"==e?this.near:this.k_near).bind(this),i=[];for(let e=0,r=this.ps.length;e<r;e++){let r=s(this.ps[e],t);r.length>0&&i.push({tp:this.ps[e],nps:r})}return i}static toGraph(t){}}class l extends o{constructor(t,e){super(t,e)}near(t,e,s=null){s=s||this.ps;let i=this.vect(t),r=[];for(let h=0,n=s.length;h<n;h++)t!==s[h]&&i.dist(this.vect(s[h]))<=e&&r.push(s[h]);return r}k_near(t,e,s=null){s=s||this.ps;let i=this.vect(t),r=[];for(let h=0,n=s.length;h<n;h++){if(t===s[h])continue;let n=i.dist(this.vect(s[h]));if(0!=r.length){if(n<r[r.length-1].dist||r.length<e){for(let t=r.length-1;t>=0;t--){if(n>=r[t].dist){r.splice(t+1,0,{dist:n,p:s[h]});break}0==t&&r.splice(0,0,{dist:n,p:s[h]})}r.length>e&&r.pop()}}else r.push({dist:n,p:s[h]})}let h=[];for(let t=0;t<r.length;t++)h.push(r[t].p);return h}}class c extends l{constructor(t,e,s=100,i=null){super(t,e),this.dn=s,this.dsr=i,this.dst=null,this.size=null,this.grid=null}static GridContainer(t,s){return new class{constructor(t,e){this.dn=t,this.size=e,this.dsize=[],this.length=1;for(let t=this.size.length;t--;){let e=Math.ceil(this.size[t]/this.dn)+1;this.length*=e,this.dsize[t]=e}this._data=new Array(this.length),this._cache_ds=null,this._cache_gns=this.gns(this.dsize.length,1)}toGrid(t){let s=[];for(let e=0,i=t.dim();e<i;e++)s[e]=Math.ceil(t.v[e]/this.dn);return new e(...s)}index(t){if(!this._cache_ds){this._cache_ds=[1];for(let t=0,e=this.dsize.length-1,s=1;t<e;t++)s*=this.dsize[t],this._cache_ds.push(s)}let e=0;for(let s=t.dim();s--;)e+=this._cache_ds[s]*t.v[s];return e}gns(t,e=1){let s=function(t,e){let s=[];for(let i=0,r=t.length;i<r;i++)for(let r=0,h=e.length;r<h;r++)s.push([...t[i],...e[r]]);return s},i=[];for(let t=-e;t<=e;t++)i.push([t]);let r=i;for(let e=0;e<t-1;e++)r=s(r,i);return r}set(t,e){let s=this.index(this.toGrid(t));return!(s<0||s>this.length)&&(this._data[s]?this._data[s].push(e):this._data[s]=[e],!0)}get(t,s=0){let i=this.toGrid(t);if(s<=0)return this._data[this.index(i)]||[];let r=1==s?this._cache_gns:this.gns(t.dim(),s),h=[];for(let t=0,s=r.length;t<s;t++){let s=this.index(new e(...r[t]).add(i));h=[...h,...this._data[s]||[]]}return h}}(t,s)}build(t=null){if(this.ps=t||this.ps,null==this.dsr){let t=this.vect(this.ps[0]).clone(),e=t.clone();for(let s=1,i=this.ps.length;s<i;s++){let i=this.vect(this.ps[s]);for(let s=0,r=i.v.length;s<r;s++)t.v[s]<i.v[s]&&(t.v[s]=i.v[s]),e.v[s]>i.v[s]&&(e.v[s]=i.v[s])}this.dsr=[];for(let s=0;s<e.v.length;s++)this.dsr[s]=[e.v[s],t.v[s]]}this.size=[],this.dst=[];for(let t=0,e=this.dsr.length;t<e;t++)this.size[t]=this.dsr[t][1]-this.dsr[t][0],this.dst[t]=this.dsr[t][0]<0?-this.dsr[t][0]:0;this.dst=new e(...this.dst),this.grid=c.GridContainer(this.dn,this.size);for(let t=0,e=this.ps.length;t<e;t++)this.grid.set(this.vect(this.ps[t]).clone().add(this.dst),this.ps[t]);return this}near(t,e){let s=Math.ceil(e/this.dn),i=this.grid.get(this.vect(t).clone().add(this.dst),s);return super.near(t,e,i)}k_near(t,e){let s=Math.max(...this.grid.dsize),i=1,r=[];for(;r.length<e&&i<=s;)r=this.grid.get(this.vect(t).clone().add(this.dst),i++);return r=this.grid.get(this.vect(t).clone().add(this.dst),Math.min(i+1,s)),super.k_near(t,e,r)}}var a=Object.freeze({__proto__:null,GridNNS:c,KDTreeNNS:class extends o{},LinearNNS:l,NearestNeighborSearch:o});class d extends i{constructor(t,e,s="min"){super(),this.tfunc=t,this.dod=[],this.val_type=s,this.p=e,this.val="min"==this.val_type?1/0:-1/0,this.vs=[],this._END=!1}action(){if(!this._END){let t=!0;for(let s=0,i=this.vs.length;s<i;s++){let i=e.add(this.p,this.vs[s]),r=this.tfunc(i);("min"==this.val_type&&r<=this.val||"max"==this.val_type&&val>=this.val)&&(this.val=r,this.p=i,t=!1),i.in(this.dod)||(t=!0)}this._END=t}return this.p}isEnd(){return this._END}}var u=Object.freeze({__proto__:null,Complex:n,Julia_Set:function(t,e,s=500){let i=t;for(let t=0;t<=s;t++)if(i=i.mult(i).add(e),i.norm()>2)return[!1,t];return[!0,s]},LSystem:class{constructor({S:t="",V:e=[],P:s={},ops:i={}}={}){this.S=t,this.V=e,this.P=s,this.ops=i}next(t=this.S){let e="";for(let s=0,i=t.length;s<i;s++)e+=t[s]in this.P?this.P[t[s]]:t[s];return e}gen(t=0){let e=this.S;for(let s=0;s<t;s++)e=this.next(e);return e}*iter(t=0){let e=this.S;for(let s=0;s<t;s++)e=this.next(e),yield e}act(t,e){for(let s=0,i=t.length;s<i;s++)t[s]in this.ops&&this.ops[t[s]](e);return e}*actIter(t,e){for(let s=0,i=t.length;s<i;s++)yield t[s]in this.ops&&this.ops[t[s]](e)}},Mandelbrot_Set:function(t,e=500){let s=new n(0,0);for(let i=0;i<=e;i++)if(s=s.mult(s).add(t),s.norm()>2)return[!1,i];return[!0,e]},NNS:a,OptimumSolutionSolvers:class{constructor(){this.n=30,this.solvers=[],this.count=1/0,this.tfunc=null,this.dod=[],this.vs=null,this.vsd=1,this.val_type="min",this.os_p=null,this.os_val=null,this._END=!1}init(){this.os_val="min"==this.val_type?1/0:-1/0,null==this.vs&&(this.vs=[new e(-1,-1).norm(this.vsd),new e(0,-1).norm(this.vsd),new e(1,-1).norm(this.vsd),new e(-1,0).norm(this.vsd),new e(1,0).norm(this.vsd),new e(-1,1).norm(this.vsd),new e(0,1).norm(this.vsd),new e(1,1).norm(this.vsd)]);for(let t=0;t<this.n;t++){let t=new d(this.tfunc,e.random(this.dod),this.val_type);t.dod=this.dod,t.vs=this.vs,this.solvers.push(t)}}next(){if(this._END||this.count<0)return this._END=!0,this.os_p;let t=!0;for(let e=0,s=this.solvers.length;e<s;e++)this.solvers[e].action(),t&=this.solvers[e].isEnd(),("min"==this.val_type&&this.solvers[e].val<=this.os_val||"max"==this.val_type&&this.solvers[e].val>=this.os_val)&&(this.os_val=this.solvers[e].val,this.os_p=this.solvers[e].p);return this._END=t,this.count--,this.os_p}isEnd(){return this._END}},boids:h});class _{refresh(t=[50,50,50],e=1920,s=1080){}line(t,e,s,i,{color:r=[255,255,255],lineWidth:h=1}={}){}circle(t,e,s,{color:i=[255,255,255],lineWidth:r=1,fill:h=!1}={}){}rect(t,e,s,i,{color:r=[255,255,255],lineWidth:h=1,fill:n=!1}={}){}polyline(t,{color:e=[255,255,255],lineWidth:s=1,close:i=!1}={}){}polygon(t,{color:e=[255,255,255]}={}){}}class p extends _{constructor(t,e,s=[50,50,50]){super(),this._context_=null,this._width=t,this._height=e,this.BGC=s}get width(){return this._width}get height(){return this._height}get cx(){return parseInt(this._width/2)}get cy(){return parseInt(this._height/2)}init(){return this}exit(){}}class v extends p{constructor(t,e,s=[0,0,0]){super(t||window.screen.width||1920,e||window.screen.height||2080,s),this._canvas_=null,this._context_=null}init(t){return this._canvas_=document.getElementById(t),this._canvas_.width=this._width,this._canvas_.height=this._height,this._context_=this._canvas_.getContext("2d"),this.refresh(),this}refresh(t=null,e=null,s=null){this._context_.fillStyle=v.RGB(...t||this.BGC),this._context_.fillRect(0,0,e||this.width,s||this.height)}line(t,e,s,i,{color:r=[255,255,255],lineWidth:h=1}={}){let n=v.RGB(...r);this._context_.strokeStyle!=n&&(this._context_.strokeStyle=n),this._context_.lineWidth!=h&&(this._context_.lineWidth=h),this._context_.beginPath(),this._context_.moveTo(t,e),this._context_.lineTo(s,i),this._context_.stroke()}circle(t,e,s=2,{color:i=[255,255,255],lineWidth:r=1,fill:h=!0}={}){let n=v.RGB(...i);this._context_.strokeStyle!=n&&(this._context_.strokeStyle=n),h&&this._context_.fillStyle!=n&&(this._context_.fillStyle=n),this._context_.lineWidth!=r&&(this._context_.lineWidth=r),this._context_.beginPath(),this._context_.arc(t,e,s,0,2*Math.PI),this._context_.stroke(),h&&this._context_.fill()}rect(t,e,s,i,{color:r=[255,255,255],lineWidth:h=1,fill:n=!1}={}){let o=v.RGB(...r);this._context_.strokeStyle!=o&&(this._context_.strokeStyle=o),n&&this._context_.fillStyle!=o&&(this._context_.fillStyle=o),this._context_.lineWidth!=h&&(this._context_.lineWidth=h),this._context_.beginPath(),this._context_.rect(t-s,e-i,2*s,2*i),this._context_.stroke(),n&&this._context_.fill()}polyline(t,{color:e=[255,255,255],lineWidth:s=1,close:i=!1}={}){let r=null!=t[0].v,h=null!=e.color;for(let n=0,o=t.length,l=i?o:o-1;n<l;n++){let i=r?t[n].v:t[n],l=r?t[(n+1)%o].v:t[(n+1)%o],c=h?e.color():e;this.line(i[0],i[1],l[0],l[1],{color:c,lineWidth:s})}}polygon(t,{color:e=[255,255,255]}={}){let s=v.RGB(...e);this._context_.fillStyle!=s&&(this._context_.fillStyle=s);let i=null!=t[0].v;this._context_.beginPath();let r=i?t[0].v:t[0];this._context_.moveTo(r[0],r[1]);for(let e=1,s=t.length;e<s;e++)r=i?t[e].v:t[e],this._context_.lineTo(r[0],r[1]);this._context_.fill()}static RGB(t,e,s,i=1){return 1==i?`rgb(${t}, ${e}, ${s})`:`rgb(${t}, ${e}, ${s}, ${i})`}static RGBtoHex(t,e,s){return`#${t=(t=parseInt(t>255?255:t<0?0:t))<16?`0${t.toString(16)}`:t.toString(16)}${e=(e=parseInt(e>255?255:e<0?0:e))<16?`0${e.toString(16)}`:e.toString(16)}${s=(s=parseInt(s>255?255:s<0?0:s))<16?`0${s.toString(16)}`:s.toString(16)}`}}class f{constructor(t){this.nodes=t}B(t){let e=this.nodes;for(;e.length>1;)e=this._bc_node_generator(e,t);return e[0]}_bc_node_generator(t,s){let i=[];for(let r=0,h=t.length-1;r<h;r++)i.push(e.lerp(t[r],t[r+1],s));return i}}class g{constructor(t){this.nodes=t,this._coefficient=this._binomial_coefficient(t.length-1)}B(t){let s=new e(0,0);for(let e=0,i=this.nodes.length,r=0;e<i;e++)r=this._coefficient[e]*Math.pow(1-t,i-1-e)*Math.pow(t,e),s.add(this.nodes[e].clone().mult(r));return s}_binomial_coefficient(t){let e=[1];if(0==t)return e;for(let s=0;s<t;s++){let t=[1];for(let s=0;s<e.length-1;s++)t.push(e[s]+e[s+1]);t.push(1),e=t}return e}}var m=Object.freeze({__proto__:null,BezierCurve:class{constructor(t,e="vector"){this.nodes=t,this._BezierCurve="vector"==e?new f(this.nodes):new g(this.nodes)}B(t){return t<0&&(t=0),t>1&&(t=1),this._BezierCurve.B(t)}}});class x{constructor(t,{max_pn:e=500,gen_pn:s=1,GENR:i=!1,DSTR:r=!0}={}){this.ps=[],this.particle_builder=t,this.action_middlewares={before:[],after:[]},this.max_pn=e,this.gen_pn=s,this.GENR=i,this.DSTR=r}build(t=0){this.ps=[];for(let e=t<this.max_pn?t:this.max_pn;e--;)this.ps.push(this.particle_builder());return this}particle_action(){let t=[];for(let e=0,s=this.ps.length;e<s;e++)this.ps[e].isEnd()?!this.DSTR&&t.push(this.ps[e]):(this.ps[e].action(),t.push(this.ps[e]));if(this.GENR){let e=this.max_pn-t.length;for(let s=e>=this.gen_pn?this.gen_pn:e;s>0;s--)t.push(this.particle_builder())}this.ps=t}action(){for(let t=0,e=this.action_middlewares.before.length;t<e;t++)this.action_middlewares.before[t](this.ps);this.particle_action();for(let t=0,e=this.action_middlewares.after.length;t<e;t++)this.action_middlewares.after[t](this.ps)}}class b{in(t){return!0}}var y=Object.freeze({__proto__:null,Area:class extends b{constructor(t,e=!1){super(),this.vps=t,this.offset=Math.PI/180*5,this.reverse=e}in(t){t=t.v?t:new e(...t);let s=0,i=this.vps.length;for(let r=0;r<i;r++){let h=Math.abs(e.rad(e.sub(this.vps[r%i],t),e.sub(this.vps[(r+1)%i],t)));s+=h>Math.PI?2*Math.PI-h:h}return this.reverse^s>2*Math.PI-this.offset&&s<2*Math.PI+this.offset}},BaseArea:b,CircleArea:class extends b{constructor(t,e,s=!1){super(),this.po=t,this.r=e,this.reverse=s}in(t){return t=t.v?t:new e(...t),this.reverse^t.dist(this.po)<this.r}},RectArea:class extends b{constructor(t,e=!1){super(),this.borders=t,this.reverse=e}in(t){t=t.v?t:new e(...t);for(let e=0,s=this.borders.length;e<s;e++)if(t.v[e]<this.borders[e][0]||t.v[e]>this.borders[e][1])return!1^this.reverse;return!0^this.reverse}}});class w{limit(t,e=0){return t}}var M=Object.freeze({__proto__:null,Border:w,RectLoopBorder:class extends w{constructor(t){super(),this.borders=t||[]}limit(t,e=0){for(let s=0;s<this.borders.length;s++)t.p.v[s]-e<=this.borders[s][0]?t.p.v[s]=this.borders[s][1]-e:t.p.v[s]+e>=this.borders[s][1]&&(t.p.v[s]=this.borders[s][0]+e);return t}},RectReflectBorder:class extends w{constructor(t,e=!0){super(),this.borders=t||[],this.on_line=e}limit(t,e=0){for(let s=0;s<this.borders.length;s++)t.p.v[s]-e<=this.borders[s][0]&&(this.on_line&&(t.p.v[s]=this.borders[s][0]+e),t.v.v[s]=-t.v.v[s]),t.p.v[s]+e>=this.borders[s][1]&&(this.on_line&&(t.p.v[s]=this.borders[s][1]-e),t.v.v[s]=-t.v.v[s]);return t}},RingLoopBorder:class extends w{constructor(t,e){super(),this.po=t,this.r=e}limit(t,e=0){if(this.po.dist(t.p)+e>this.r){let s=Vector.sub(this.po,t.p).normalization();t.p=Vector.add(this.po,s.clone().mult(this.r-e))}return t}},RingReflectBorder:class extends w{constructor(t,e){super(),this.po=t,this.r=e}limit(t,e=0){if(this.po.dist(t.p)+e>this.r){let s=Vector.sub(this.po,t.p).normalization();t.p=Vector.add(this.po,s.clone().mult(-(this.r-e))),t.v=Vector.sub(t.v,s.clone().mult(2*s.dot(t.v)))}return t}}});class S{to(t){return t}from(t){return t}}var R=Object.freeze({__proto__:null,CoordinateSystem:S,Grid:class extends S{constructor(t,e=1,s=1,i=!1){super(),this.co=t,this._dx=e,this._dy=s,this._RY=i?-1:1}get dx(){return this._dx}set dx(t){if(t<1)throw Error(`dx(${t}) must be in [1, Inf)`);this._dx=Math.round(t)}get dy(){return this._dy}set dy(t){if(t<1)throw Error(`dy(${t}) must be in [1, Inf)`);this._dy=Math.round(t)}get RY(){return-1==this._RY}set RY(t){this._RY=t?-1:1}to(t){let s=Math.round(((t.v?t.v[0]:t[0])-this.co.x)/this.dx),i=Math.round(((t.v?t.y:t[1])-this.co.y)/this.dy)*this._RY;return t.v?e.v(s,i):[s,i]}from(t){let s=this.dx*(t.v?t.x:t[0])+this.co.x,i=this.dy*(t.v?t.y:t[1])*this._RY+this.co.y;return t.v?e.v(s,i):[s,i]}},PolarCS:class extends S{constructor(t){super(),this.co=t}to(t){let s=(t.v?t:new e(...t)).sub(this.co),i=s.dist(),r=s.rad();return t.v?e.v(i,r):[i,r]}from(t){let s=t.v?t.x:t[0],i=t.v?t.y:t[1],r=s*Math.sin(i)+this.co.x,h=s*Math.cos(i)+this.co.y;return t.v?e.v(r,h):[r,h]}},RCS:class extends S{constructor(t,e=1){super(),this._co=t,this._scale=e}get scale(){return this._scale}set scale(t){if(t<=0)throw Error(`scale(${t}) must be in (0, Inf)`);this._scale=t}get co(){return this._co.clone()}to(t){let s=((t.v?t.x:t[0])-this._co.x)*this._scale,i=-1*((t.v?t.y:t[1])-this._co.y)*this._scale;return t.v?e.v(s,i):[s,i]}from(t){let s=(t.v?t.x:t[0])/this._scale+this._co.x,i=-1*(t.v?t.y:t[1])/this._scale+this._co.y;return t.v?e.v(s,i):[s,i]}zoom(t){return t>0?this.scale/=Math.abs(t):this.scale*=Math.abs(t),this}move(t){return this._co.add(t.v?t:e.v(...t)),this}}});class I{constructor(t){this.area=t||new b}force(t){}}class C extends I{static G=.01;constructor(t,s=1){super(),this.gp=t||new e(0,0),this.mass=s,this.G=C.G}force(t){if(this.area.in(t.p)){let s=this.gp.dist(t.p),i=e.sub(this.gp,t.p).norm(this.G*(this.mass*t.mass)/s*s);t.force(i)}}static gravity(t,s){let i=e.dist(t.p,s.p),r=C.G*(t.mass*s.mass)/i*i;t.force(e.sub(s.p,t.p).norm(r)),s.force(e.sub(t.p,s.p).norm(r))}}var z=Object.freeze({__proto__:null,AccelerateField:class extends I{constructor(t,e){super(e),this.A=t}force(t){t.force(this.A)}},DecelerateField:class extends I{constructor(t,e){super(e),this._D=-Math.abs(t||.015)}get D(){return this._D}set D(t){this._D=-Math.abs(t)}force(t){this.area.in(t.p)&&t.force(t.v.clone().norm(this.D*t.v.norm()*t.mass))}},DeflectField:class extends I{constructor(t,e){super(e),this.W=t||.017}force(t){this.area.in(t.p)&&t.force(e.sub(t.v.clone().rotate(this.W),t.v))}},Field:I,Gravity:C});var P=Object.freeze({__proto__:null,CircularMotion:class extends i{constructor(t,e=1,s=Math.PI/180,i=0){super(),this.o=t||new Vector(0,0),this.r=e,this.w=s,this.rad=i,this.po=new Vector(this.r*Math.sin(this.rad),this.r*Math.cos(this.rad)),this.p=Vector.add(this.po,this.o)}action(){return this._p=this.p.clone(),this.rad+=this.w,this.rad>=2*Math.PI&&(this.rad-=2*Math.PI),this.rad<=-2*Math.PI&&(this.rad+=2*Math.PI),this.po.x=this.r*Math.sin(this.rad),this.po.y=this.r*Math.cos(this.rad),this.p=Vector.add(this.po,this.o),this.v=this.p.clone().sub(this._p),this.p}},ForceParticle:class extends i{constructor(t,e,s,i){super(),this.p=t||new Vector(0,0),this.v=e||new Vector(0,0),this.acc=s||new Vector(0,0),this.mass=i||1}force(t){this.acc.add(t.clone().mult(1/this.mass))}action(){return this.p.add(this.v.add(this.acc)),this.acc=new Vector(0,0),this.p}},LinearMotion:class extends i{constructor(t,e,s=1){super(),this._ps=t,this._pe=e,this.p=this._ps.clone(),this.v=Vector.sub(this._pe,this._ps).norm(Math.abs(s)),this.mode="line",this.end_dist_rate=1.2}get ps(){return this._ps.clone()}get pe(){return this._pe.clone()}set pe(t){this._pe=t.clone(),this.v=Vector.sub(this._pe,this.p).norm(this.v.norm())}set v_rate(t){this.v.norm(t)}set v_count(t){this.v.norm(Vector.dist(this._pe,this._ps)/t)}isEnd(){return this.p.dist(this._pe)<=this.v.norm()*this.end_dist_rate}action(){if(this.isEnd())switch(this.mode){case"loop":this.p=this._ps.clone();break;case"back":this.p=this._pe.clone(),this._pe=this._ps.clone(),this._ps=this.p.clone(),this.v.mult(-1);break;default:this.p=this._pe.clone()}else this.p.add(this.v);return this.p}},Particle:i,ParticleAssembler:class extends i{constructor(t,e){super(t),this.po=t.clone(),this.ps=e}action(){this.p=this.po.clone();for(let t=0,e=this.ps.length;t<e;t++)this.p.add(this.ps[t].action());return this.p}},ParticleSystem:x,RandomWalker:class extends i{constructor(t,e){super(),this.p=t,this._rvs=this._probability(e)}_probability(t){let e=0;for(let s=0,i=t.length;s<i;s++)e+=t[s][1];let s=[],i=0;for(let r=0,h=t.length;r<h;r++){let h=(t[r][1]||0)/e;s.push({v:t[r][0]||new Vector(0,0),p:h,ps:i,pe:i+h}),i+=h}return s}rv_select(){let t=Math.random();for(let e=0,s=this._rvs.length;e<s;e++)if(t>this._rvs[e].ps&&t<=this._rvs[e].pe)return this._rvs[e].v}action(){return this.v=this.rv_select(),this.p.add(this.v)}},SimpleHarmonicMotion:class extends i{constructor(t,e,s,i=0){super(t,e),this.p0=this.p.clone(),this.v0=this.v.clone().norm(1),this.A=this.v.norm(),this.w=s,this.rad0=i,this._rad=i,this._2PI=2*Math.PI}action(){return this._rad+=this.w,this._rad>this._2PI&&(this._rad-=this._2PI),this.p=this.v0.clone().mult(this.A*Math.sin(this._rad)),this.p}get T(){return 2*Math.PI/this.w}expression(){return`(${this.A.toFixed(2)})*sin((${this.w.toFixed(2)})*t+(${this.rad0.toFixed(2)}))`}},TrailTracker:class{constructor(t,e=10){this.tp=t,this.tn=e,this.trail=[],this._bind()}_bind(){this.trail=[this.tp.p.clone()];let t=this;this.tp._tracker_hook_action=this.tp.action,this.tp.action=function(){let e=this._tracker_hook_action(...arguments);return t.trail.length>=t.tn&&t.trail.shift(),t.trail.push(e.clone()),e}}},area:y,border:M,coor:R,field:z});class k{constructor(t){this._val=t}val(){return this._val}end(){return!1}tolist(t=500){let e=[];for(let s=0;s<t&&(e.push(this.val()),!this.end());s++);return e}}class E extends k{constructor(t,e,s=1){super(t),this._start=t,this._end=e,this._step=t<e?Math.abs(s):-Math.abs(s)}static S(t,e,s=1){return new E(t,e,s)}static N(t,e,s){return new E(t,e,(e-t)/s)}val(){let t=this._val;return this.end()?this._val=this._end:this._val+=this._step,t}end(){return this._step>0?this._val>this._end:this._val<this._end}clone(){return new E(this._start,this._end,this._step)}}var G=Object.freeze({__proto__:null,FuncIterator:class extends k{constructor(t,e){super(),this.fx=t,this.dod=e.val?e:E.S(...e)}val(t=!1){let e=this.dod.val();return t?[e,this.fx(e)]:this.fx(e)}end(){return this.dod.end()}},Iterator:k,Range:E});class B{static regular_polygon(t,e,s,i=0){s=s||[0,0];let r=2*Math.PI/t,h=[];for(let n=0;n<t;n++)h.push([e*Math.cos(i)+s[0],e*Math.sin(i)+s[1]]),i+=r;return h}static RP(t,e,s,i=0){return B.regular_polygon(t,e,s,i)}static ATR(t){return Math.PI/180*t}static RTA(t){return 180/Math.PI*t}static random(t,e){return(e-t)*Math.random()+t}static rselect(t){return t[parseInt(t.length*Math.random())]}static RGB(t){return`rgb(${t[0]||0}, ${t[1]||0}, ${t[2]||0}, ${t[3]||1})`}}var V=Object.freeze({__proto__:null,RandomSelector:class{constructor(t){this._ops=this._probability(t)}_probability(t){let e=0;for(let s=0,i=t.length;s<i;s++)e+=t[s][1]||0;let s=[],i=0;for(let r=0,h=t.length;r<h;r++){let h=(t[r][1]||0)/e;s.push({op:t[r][0],p:h,ps:i,pe:i+h}),i+=h}return s}select(){let t=Math.random();for(let e=0,s=this._ops.length;e<s;e++)if(t>this._ops[e].ps&&t<=this._ops[e].pe)return this._ops[e].op}},Tools:B,iter:G});class ${constructor(t,e){this.context=t,this.fileTitle=e||document.getElementsByTagName("title")[0].innerText.replace(/\s+/g,""),this.fn=0,this._capture_keyCode="Q".charCodeAt()}get captureKey(){return String.fromCharCode(this._capture_keyCode)}set captureKey(t){return this._capture_keyCode=t.charCodeAt(),this}capturing(){let t=this;return window.addEventListener("keydown",(function(e){e.keyCode==t._capture_keyCode&&t.capture()})),this}capture(t){t=t||`${this.fileTitle}_${this.fn++}`,this.context._canvas_.toBlob((e=>{let s=document.createElement("a");s.style.display="none",s.id=t,s.href=window.URL.createObjectURL(e),s.download=`${t}.png`,s.click()}))}}class N extends e{constructor(t=0,e=0,s=0,i=1){1==i?super(t,e,s):super(t,e,s,i)}get r(){return this.v[0]}get g(){return this.v[1]}get b(){return this.v[2]}get a(){return this.v[3]||1}set r(t){this.v[0]=t}set g(t){this.v[1]=t}set b(t){this.v[2]=t}set a(t){this.v[3]=t}color(){return[...this.v]}clone(){return new N(...this.v)}}class D{constructor(t,s,i){this.scv=new N(...t),this.ecv=new N(...s),this.cv=this.scv.clone(),this.n=i,this._count=i,this._dcv=e.sub(this.ecv,this.scv).norm(e.dist(this.ecv,this.scv)/i)}color(){let t=this.cv.color();return this._count>0&&this.cv.add(this._dcv),this._count--,t}isEnd(){return!(this._count>0)}}var T=Object.freeze({__proto__:null,ColorGradient:D,ColorVector:N});class A{constructor(t=60){this._ft=0,this.fps=t}get ft(){return this._ft}render(){this._ft++}}var O=Object.freeze({__proto__:null,IntervalRenderer:class extends A{constructor(t=60){super(t),this._stop_ftp=1/0,this._timer=null,this.renderer_func=null}render(t){return this.renderer_func=t,this._timer=setInterval((()=>{this._ft<this._stop_ftp?this.renderer_func(this._ft++):clearInterval(this._timer)}),Math.ceil(1e3/this.fps)),this}stop(t){return this._stop_ftp=t,this}},SingleFrameRenderer:class extends A{constructor(t=1){super(1),this.act_ft_n=t,this.act_func=null,this.draw_func=null,this._render_keyCode=" ".charCodeAt()}get renderKey(){return String.fromCharCode(this._render_keyCode)}set renderKey(t){this._render_keyCode=t.charCodeAt()}render(t,e){this.act_func=t,this.draw_func=e;let s=this;return window.addEventListener("keydown",(function(t){if(t.keyCode==s._render_keyCode){for(let t=0;t<s.act_ft_n;t++)s.act_func(s._ft++);s.draw_func&&s.draw_func(s._ft)}})),this}}});class W{context=null;static nodelink(t,e=[0,100],s=[255,255,255]){let i="number"==typeof e?[0,e]:e,r=i[1]-i[0],h=s.color?s:new N(...s);for(let e=0,s=t.length;e<s;e++){let n=h.color();for(let h=e;h<s;h++){let s=t[e].p.dist(t[h].p);s>=i[0]&&s<=i[1]&&W.context.line(t[e].p.x,t[e].p.y,t[h].p.x,t[h].p.y,{color:[...n,1-s/r]})}}}static grid({co:t,dx:s,dy:i,xR:r,yR:h,color:n=[255,255,255],center:o=!0}){t=t||new e(W.context.cx,W.context.cy),i=i||s;let l=(r=r||[-parseInt(W.context.cx/s)-1,parseInt(W.context.cx/s)+1])[0]*s+t.x,c=r[1]*s+t.x,a=(h=h||[-parseInt(W.context.cy/i)-1,parseInt(W.context.cy/i)+1])[0]*i+t.y,d=h[1]*i+t.y,u=o?0:s/2,_=o?0:i/2;for(let e=r[0],i=r[1];e<=i;e++){let i=e*s+t.x+u;W.context.line(i,a,i,d,{color:[n[0],n[1],n[2],n[3]||.25]})}for(let e=h[0],s=h[1];e<=s;e++){let s=e*i+t.y+_;W.context.line(l,s,c,s,{color:[n[0],n[1],n[2],n[3]||.25]})}}static lightLine(t,{Lfx:e,n:s=10,d:i=3,cs:r=[255,255,255],ce:h=[0,0,0]}={}){let n=(e=e||(t=>1/(t+1e-4)))(1),o=e(s);for(let l=s;l>0;l--){let s=(e(l)-o)/(n-o),c=[(r[0]-h[0])*s+h[0],(r[1]-h[1])*s+h[1],(r[2]-h[2])*s+h[2]];W.context.polyline(t,{color:new D(c,h,t.length),lineWidth:l*i})}}static lightRing(t,e,s,{Lfx:i,n:r=50,cs:h=[255,255,255],ce:n=[0,0,0],point:o=!1}={}){i=i||(t=>1/(t+1e-4));let l=i(1),c=i(r),a=s/r;for(let s=r;s>0;s--){let d=(i(o?s:r-s)-c)/(l-c),u=[(h[0]-n[0])*d+n[0],(h[1]-n[1])*d+n[1],(h[2]-n[2])*d+n[2]];W.context.circle(t,e,a*s,{color:u})}}static trail(t,{split_x:e=100,split_y:s=100,color:i=[255,255,255]}={}){let r=[[]];for(let i=0,h=t.length-1;i<h;i++)r[r.length-1].push(t[i]),Math.abs(t[i].x-t[i+1].x)>e|Math.abs(t[i].y-t[i+1].y)>s&&r.push([]);for(let t=0,e=r.length;t<e;t++)r[t].length<=1||W.context.polyline(r[t],{color:i})}}var j=Object.freeze({__proto__:null,Capturer:$,ColorGradient:D,ColorVector:N,Views:W,renderer:O});t.CanvasContext=v,t.Capturer=$,t.Particle=i,t.ParticleSystem=x,t.Tools=B,t.Vector=e,t.Views=W,t.algo=u,t.color=T,t.math=m,t.particle=P,t.renderer=O,t.utils=V,t.vector=s,t.views=j}));
