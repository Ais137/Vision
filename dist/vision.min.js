!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports):"function"==typeof define&&define.amd?define(["exports"],s):s((t="undefined"!=typeof globalThis?globalThis:t||self).vision={})}(this,(function(t){"use strict";let s=class t{constructor(...t){this.v=t.length>0?[...t]:[0,0]}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}set x(t){this.v[0]=t}set y(t){this.v[1]=t}set z(t){this.v[2]=t}static v(...s){return new t(...s)}static V(...s){return new t(...s)}static ones(s=2){return new t(...Array(s).fill(1))}static zeros(s=2){return new t(...Array(s).fill(0))}static random(s=[],e=!1){let i=[],r=0;for(let t=0,h=s.length;t<h;t++)r=Math.random()*(s[t][1]-s[t][0])+s[t][0],e?i.push(parseInt(r)):i.push(r);return new t(...i)}static rcv(s,e=null){let i=Math.random()*(2*Math.PI),r=null==e?Math.random()*s:Math.random()*(e-s)+s;return new t(Math.cos(i)*r,Math.sin(i)*r)}add(t){for(let s=0,e=this.v.length;s<e;s++)this.v[s]+=t.v[s]||0;return this}static add(...s){let e=t.zeros(s[0].dim());for(let t=0,i=s.length;t<i;t++)e.dim()<s[t].dim()&&e.dim(s[t].dim()),e.add(s[t]);return e}mult(t){for(let s=0,e=this.v.length;s<e;s++)this.v[s]*=t;return this}static mult(t,s){return t.clone().mult(s)}sub(t){for(let s=0,e=this.v.length;s<e;s++)this.v[s]-=t.v[s]||0;return this}static sub(...t){let s=t[0].clone();for(let e=1,i=t.length;e<i;e++)s.sub(t[e]);return s}dot(t){let s=0;for(let e=0,i=this.v.length;e<i;e++)s+=this.v[e]*(t.v[e]||0);return s}inner(t){return this.dot(t)}static LC(s,e){let i=t.zeros(s[0].dim());for(let t=0,r=s.length;t<r;t++)i.add(s[t].clone().mult(e[t]));return i}LM(t){let s=[];for(let e=0,i=t.length;e<i;e++){let i=0;for(let s=0,r=t[e].length;s<r;s++)i+=t[e][s]*(this.v[s]||0);s.push(i)}return this.v=s,this}static LM(t,s){return t.clone().map(s)}lerp(t,s){return s>0&&s<1?t.clone().sub(this).mult(s).add(this):s<=0?this.clone():t.clone()}static lerp(t,s,e){return t.lerp(s,e)}rotate(t,s=!1){t=s?Math.PI/180*t:t;let e=Math.cos(t),i=Math.sin(t),r=this.v[0]*e-this.v[1]*i,h=this.v[0]*i+this.v[1]*e;return this.v[0]=r,this.v[1]=h,this}static rotate(t,s){return t.clone().rotate(s)}dim(t=null){if(null!=t){let s=[],e=parseInt(t);for(let t=0;t<e;t++)s[t]=this.v[t]||0;return this.v=s,this}return this.v.length}norm(t=null){let s=0;for(let t=0,e=this.v.length;t<e;t++)s+=this.v[t]*this.v[t];let e=Math.sqrt(s);return null!=t&&0!=e&&this.mult(t/e),null==t?e:this}normalization(){let t=this.norm();return 0!=t&&this.mult(1/t),this}limit(t,s=null){let e,i,r=this.norm();return null==s?(i=0,e=Math.abs(t)):(i=Math.abs(t),e=Math.abs(s)),!(r>=i&&r<=e)&&this.norm(r>e?e:i),this}clone(){return new t(...this.v)}copy(){return this.clone()}dist(t=null){if(null==t)return this.norm();{let s=0,e=t.v;for(let t=0,i=this.v.length;t<i;t++)s+=(this.v[t]-e[t])*(this.v[t]-e[t]);return Math.sqrt(s)}}static dist(t,s){return t.dist(s)}rad(t=null){let s=this.v[0],e=this.v[1],i=Math.atan(e/s);return i=s>=0?e>=0?i:2*Math.PI+i:Math.PI+i,t?i-t.rad():i}static rad(t,s){return t.rad(s)}toint(){for(let t=0,s=this.v.length;t<s;t++)this.v[t]=parseInt(this.v[t])}in(t=[]){for(let s=0,e=t.length;s<e;s++)if(!(this.v[s]>=t[s][0]&&this.v[s]<=t[s][1]))return!1;return!0}static in(t,s){return t.in(s)}static vpoints(s){let e=[];for(let i=0,r=s.length;i<r;i++)e.push(new t(...s[i]));return e}};var e=Object.freeze({__proto__:null,Vector:s});class i{constructor(t,e){this.p=t||new s(0,0),this.v=e||new s(0,0)}action(){return this.p.add(this.v)}isEnd(){return!1}}class r extends i{static RuleSet={alignment:(t,e)=>{let i=new s(0,0);for(let t=0,s=e.length;t<s;t++)i.add(e[t].v);return i.mult(1/e.length)},separation:(t,e)=>{let i=new s(0,0);for(let r=0,h=e.length;r<h;r++){let h=t.p.dist(e[r].p);i.add(s.sub(t.p,e[r].p).norm(1/h*h))}return i},cohesion:(t,e)=>{let i=new s(0,0);for(let t=0,s=e.length;t<s;t++)i.add(e[t].p);return i.mult(1/e.length),s.sub(i,t.p)}};constructor(t,e,i,h){super(t,e),this.R=i,this.K=h,this.visual_field=(t,s)=>s,this.rules=[r.RuleSet.alignment,r.RuleSet.separation,r.RuleSet.cohesion],this.acc=new s(0,0)}rules_action(t){if(0==t.length)return;t=this.visual_field(this,t);let e=[];for(let s=0,i=this.rules.length;s<i;s++)e[s]=this.rules[s](this,t);this.acc.add(s.LC(e,this.K))}action(){return this.p.add(this.v.add(this.acc)),this.acc=new s(0,0),this.p}}var h=Object.freeze({__proto__:null,Boid:r,boids_middlewares:function(t){return function(s){t.build(s);for(let e=s.length;e--;)s[e].rules_action(t.near(s[e],s[e].R))}}});class n{constructor(t,s){this.r=t,this.i=s}add(t){return this.r+=t.r,this.i+=t.i,this}mult(t){let s=this.r,e=this.i,i=t.r,r=t.i;return this.r=s*i-e*r,this.i=e*i+s*r,this}norm(){return Math.sqrt(this.r*this.r+this.i*this.i)}}class l{constructor(t,s){this.vect=s||function(t){return t},this.ps=t,this.IS_LOOP_BORDER=!1}build(t=null){return this.ps=t||this.ps,this}near(t,s){return[]}k_near(t,s){return[]}nps(t,s="dist"){let e=("dist"==s?this.near:this.k_near).bind(this),i=[];for(let s=0,r=this.ps.length;s<r;s++){let r=e(this.ps[s],t);r.length>0&&i.push({tp:this.ps[s],nps:r})}return i}static toGraph(t){}}class o extends l{constructor(t,s){super(t,s)}near(t,s,e=null){e=e||this.ps;let i=this.vect(t),r=[];for(let h=0,n=e.length;h<n;h++)t!==e[h]&&i.dist(this.vect(e[h]))<=s&&r.push(e[h]);return r}k_near(t,s,e=null){e=e||this.ps;let i=this.vect(t),r=[];for(let h=0,n=e.length;h<n;h++){if(t===e[h])continue;let n=i.dist(this.vect(e[h]));if(0!=r.length){if(n<r[r.length-1].dist||r.length<s){for(let t=r.length-1;t>=0;t--){if(n>=r[t].dist){r.splice(t+1,0,{dist:n,p:e[h]});break}0==t&&r.splice(0,0,{dist:n,p:e[h]})}r.length>s&&r.pop()}}else r.push({dist:n,p:e[h]})}let h=[];for(let t=0;t<r.length;t++)h.push(r[t].p);return h}}class a extends o{constructor(t,s,e=100,i=null){super(t,s),this.dn=e,this.dsr=i,this.dst=null,this.size=null,this.grid=null}static GridContainer(t,e){return new class{constructor(t,s){this.dn=t,this.size=s,this.dsize=[],this.length=1;for(let t=this.size.length;t--;){let s=Math.ceil(this.size[t]/this.dn)+1;this.length*=s,this.dsize[t]=s}this._data=new Array(this.length),this._cache_ds=null,this._cache_gns=this.gns(this.dsize.length,1)}toGrid(t){let e=[];for(let s=0,i=t.dim();s<i;s++)e[s]=Math.ceil(t.v[s]/this.dn);return new s(...e)}index(t){if(!this._cache_ds){this._cache_ds=[1];for(let t=0,s=this.dsize.length-1,e=1;t<s;t++)e*=this.dsize[t],this._cache_ds.push(e)}let s=0;for(let e=t.dim();e--;)s+=this._cache_ds[e]*t.v[e];return s}gns(t,s=1){let e=function(t,s){let e=[];for(let i=0,r=t.length;i<r;i++)for(let r=0,h=s.length;r<h;r++)e.push([...t[i],...s[r]]);return e},i=[];for(let t=-s;t<=s;t++)i.push([t]);let r=i;for(let s=0;s<t-1;s++)r=e(r,i);return r}set(t,s){let e=this.index(this.toGrid(t));return!(e<0||e>this.length)&&(this._data[e]?this._data[e].push(s):this._data[e]=[s],!0)}get(t,e=0){let i=this.toGrid(t);if(e<=0)return this._data[this.index(i)]||[];let r=1==e?this._cache_gns:this.gns(t.dim(),e),h=[];for(let t=0,e=r.length;t<e;t++){let e=this.index(new s(...r[t]).add(i));h=[...h,...this._data[e]||[]]}return h}}(t,e)}build(t=null){if(this.ps=t||this.ps,null==this.dsr){let t=this.vect(this.ps[0]).clone(),s=t.clone();for(let e=1,i=this.ps.length;e<i;e++){let i=this.vect(this.ps[e]);for(let e=0,r=i.v.length;e<r;e++)t.v[e]<i.v[e]&&(t.v[e]=i.v[e]),s.v[e]>i.v[e]&&(s.v[e]=i.v[e])}this.dsr=[];for(let e=0;e<s.v.length;e++)this.dsr[e]=[s.v[e],t.v[e]]}this.size=[],this.dst=[];for(let t=0,s=this.dsr.length;t<s;t++)this.size[t]=this.dsr[t][1]-this.dsr[t][0],this.dst[t]=this.dsr[t][0]<0?-this.dsr[t][0]:0;this.dst=new s(...this.dst),this.grid=a.GridContainer(this.dn,this.size);for(let t=0,s=this.ps.length;t<s;t++)this.grid.set(this.vect(this.ps[t]).clone().add(this.dst),this.ps[t]);return this}near(t,s){let e=Math.ceil(s/this.dn),i=this.grid.get(this.vect(t).clone().add(this.dst),e);return super.near(t,s,i)}k_near(t,s){let e=Math.max(...this.grid.dsize),i=1,r=[];for(;r.length<s&&i<=e;)r=this.grid.get(this.vect(t).clone().add(this.dst),i++);return r=this.grid.get(this.vect(t).clone().add(this.dst),Math.min(i+1,e)),super.k_near(t,s,r)}}var c=Object.freeze({__proto__:null,GridNNS:a,KDTreeNNS:class extends l{},LinearNNS:o,NearestNeighborSearch:l});class d extends i{constructor(t,s,e="min"){super(),this.tfunc=t,this.dod=[],this.val_type=e,this.p=s,this.val="min"==this.val_type?1/0:-1/0,this.vs=[],this._END=!1}action(){if(!this._END){let t=!0;for(let e=0,i=this.vs.length;e<i;e++){let i=s.add(this.p,this.vs[e]),r=this.tfunc(i);("min"==this.val_type&&r<=this.val||"max"==this.val_type&&val>=this.val)&&(this.val=r,this.p=i,t=!1),i.in(this.dod)||(t=!0)}this._END=t}return this.p}isEnd(){return this._END}}var u=Object.freeze({__proto__:null,Complex:n,Julia_Set:function(t,s,e=500){let i=t;for(let t=0;t<=e;t++)if(i=i.mult(i).add(s),i.norm()>2)return[!1,t];return[!0,e]},LSystem:class{constructor({S:t="",V:s=[],P:e={},ops:i={}}={}){this.S=t,this.V=s,this.P=e,this.ops=i}next(t=this.S){let s="";for(let e=0,i=t.length;e<i;e++)s+=t[e]in this.P?this.P[t[e]]:t[e];return s}gen(t=0){let s=this.S;for(let e=0;e<t;e++)s=this.next(s);return s}*iter(t=0){let s=this.S;for(let e=0;e<t;e++)s=this.next(s),yield s}act(t,s){for(let e=0,i=t.length;e<i;e++)t[e]in this.ops&&this.ops[t[e]](s);return s}*actIter(t,s){for(let e=0,i=t.length;e<i;e++)yield t[e]in this.ops&&this.ops[t[e]](s)}},Mandelbrot_Set:function(t,s=500){let e=new n(0,0);for(let i=0;i<=s;i++)if(e=e.mult(e).add(t),e.norm()>2)return[!1,i];return[!0,s]},NNS:c,OptimumSolutionSolvers:class{constructor(){this.n=30,this.solvers=[],this.count=1/0,this.tfunc=null,this.dod=[],this.vs=null,this.vsd=1,this.val_type="min",this.os_p=null,this.os_val=null,this._END=!1}init(){this.os_val="min"==this.val_type?1/0:-1/0,null==this.vs&&(this.vs=[new s(-1,-1).norm(this.vsd),new s(0,-1).norm(this.vsd),new s(1,-1).norm(this.vsd),new s(-1,0).norm(this.vsd),new s(1,0).norm(this.vsd),new s(-1,1).norm(this.vsd),new s(0,1).norm(this.vsd),new s(1,1).norm(this.vsd)]);for(let t=0;t<this.n;t++){let t=new d(this.tfunc,s.random(this.dod),this.val_type);t.dod=this.dod,t.vs=this.vs,this.solvers.push(t)}}next(){if(this._END||this.count<0)return this._END=!0,this.os_p;let t=!0;for(let s=0,e=this.solvers.length;s<e;s++)this.solvers[s].action(),t&=this.solvers[s].isEnd(),("min"==this.val_type&&this.solvers[s].val<=this.os_val||"max"==this.val_type&&this.solvers[s].val>=this.os_val)&&(this.os_val=this.solvers[s].val,this.os_p=this.solvers[s].p);return this._END=t,this.count--,this.os_p}isEnd(){return this._END}},boids:h});class p{constructor(t,s,e,i="rgb(50, 50, 50)"){this.canvas=document.getElementById(t),this._width=this.canvas.width=s||window.screen.width,this._height=this.canvas.height=e||window.screen.height,this._cx=parseInt(this._width/2),this._cy=parseInt(this._height/2),this.ctx=this.canvas.getContext("2d"),this.BGC=i,this.POINT={R:2,C:"#FFFFFF"},this.refresh()}get width(){return this._width}set width(t){this._width=this.canvas.width=t,this._cx=parseInt(this._width/2),this.refresh()}get height(){return this._height}set height(t){this._height=this.canvas.height=t,this._cy=parseInt(this._height/2),this.refresh()}get cx(){return this._cx}get cy(){return this._cy}set colorStyle(t){this.ctx.strokeStyle=this.ctx.fillStyle=t}resize(t,s){this.width=parseInt(t)||window.screen.width,this.height=parseInt(s)||window.screen.height}refresh(t){this.ctx.fillStyle=t||this.BGC,this.ctx.fillRect(0,0,this._width,this._height)}point(t,s,e=null,i=null){"number"!=typeof arguments[0]&&(t=arguments[0].x,s=arguments[0].y),this.ctx.strokeStyle=this.ctx.fillStyle=e||this.POINT.C,this.ctx.beginPath(),this.ctx.arc(t,s,i||this.POINT.R,0,2*Math.PI),this.ctx.stroke(),this.POINT.R>1&&this.ctx.fill()}line(t,s,e,i){"number"!=typeof arguments[0]&&(t=arguments[0].x,s=arguments[0].y,e=arguments[1].x,i=arguments[1].y),this.ctx.beginPath(),this.ctx.moveTo(t,s),this.ctx.lineTo(e,i),this.ctx.stroke()}lines(t,s="rgb(255, 255, 255)",e=!1){let i=null!=t[0].x,r=null!=s.color;for(let h=0,n=t.length,l=e?n:n-1;h<l;h++)this.ctx.beginPath(),this.ctx.strokeStyle=r?s.color():s,i?(this.ctx.moveTo(t[h].x,t[h].y),this.ctx.lineTo(t[(h+1)%n].x,t[(h+1)%n].y)):(this.ctx.moveTo(t[h][0],t[h][1]),this.ctx.lineTo(t[(h+1)%n][0],t[(h+1)%n][1])),this.ctx.stroke()}circle(t,s,e,i=null){i&&(this.ctx.strokeStyle=this.ctx.fillStyle=i),this.ctx.beginPath(),this.ctx.arc(t,s,e,0,2*Math.PI),this.ctx.stroke(),i&&this.ctx.fill()}rect(t,s,e,i){this.ctx.beginPath(),this.ctx.rect(t-e,s-i,2*e,2*i),this.ctx.stroke()}}var _=Object.freeze({__proto__:null,Canvas:p});class v{in(t){return!0}}var f=Object.freeze({__proto__:null,Area:class extends v{constructor(t,s=!1){super(),this.vps=t,this.offset=Math.PI/180*5,this.reverse=s}in(t){t=t.v?t:new s(...t);let e=0,i=this.vps.length;for(let r=0;r<i;r++){let h=Math.abs(s.rad(s.sub(this.vps[r%i],t),s.sub(this.vps[(r+1)%i],t)));e+=h>Math.PI?2*Math.PI-h:h}return this.reverse^e>2*Math.PI-this.offset&&e<2*Math.PI+this.offset}},BaseArea:v,CircleArea:class extends v{constructor(t,s,e=!1){super(),this.po=t,this.r=s,this.reverse=e}in(t){return t=t.v?t:new s(...t),this.reverse^t.dist(this.po)<this.r}},RectArea:class extends v{constructor(t,s=!1){super(),this.borders=t,this.reverse=s}in(t){t=t.v?t:new s(...t);for(let s=0,e=this.borders.length;s<e;s++)if(t.v[s]<this.borders[s][0]||t.v[s]>this.borders[s][1])return!1^this.reverse;return!0^this.reverse}}});class g{limit(t,s=0){return t}}var x=Object.freeze({__proto__:null,Border:g,RectLoopBorder:class extends g{constructor(t){super(),this.borders=t||[]}limit(t,s=0){for(let e=0;e<this.borders.length;e++)t.p.v[e]-s<=this.borders[e][0]?t.p.v[e]=this.borders[e][1]-s:t.p.v[e]+s>=this.borders[e][1]&&(t.p.v[e]=this.borders[e][0]+s);return t}},RectReflectBorder:class extends g{constructor(t,s=!0){super(),this.borders=t||[],this.on_line=s}limit(t,s=0){for(let e=0;e<this.borders.length;e++)t.p.v[e]-s<=this.borders[e][0]&&(this.on_line&&(t.p.v[e]=this.borders[e][0]+s),t.v.v[e]=-t.v.v[e]),t.p.v[e]+s>=this.borders[e][1]&&(this.on_line&&(t.p.v[e]=this.borders[e][1]-s),t.v.v[e]=-t.v.v[e]);return t}},RingLoopBorder:class extends g{constructor(t,s){super(),this.po=t,this.r=s}limit(t,s=0){if(this.po.dist(t.p)+s>this.r){let e=Vector.sub(this.po,t.p).normalization();t.p=Vector.add(this.po,e.clone().mult(this.r-s))}return t}},RingReflectBorder:class extends g{constructor(t,s){super(),this.po=t,this.r=s}limit(t,s=0){if(this.po.dist(t.p)+s>this.r){let e=Vector.sub(this.po,t.p).normalization();t.p=Vector.add(this.po,e.clone().mult(-(this.r-s))),t.v=Vector.sub(t.v,e.clone().mult(2*e.dot(t.v)))}return t}}});class m{to(t){return t}from(t){return t}}var b=Object.freeze({__proto__:null,CoordinateSystem:m,Grid:class extends m{constructor(t,s=1,e=1,i=!1){super(),this.co=t,this._dx=s,this._dy=e,this._RY=i?-1:1}get dx(){return this._dx}set dx(t){if(t<1)throw Error(`dx(${t}) must be in [1, Inf)`);this._dx=Math.round(t)}get dy(){return this._dy}set dy(t){if(t<1)throw Error(`dy(${t}) must be in [1, Inf)`);this._dy=Math.round(t)}get RY(){return-1==this._RY}set RY(t){this._RY=t?-1:1}to(t){let e=Math.round(((t.v?t.v[0]:t[0])-this.co.x)/this.dx),i=Math.round(((t.v?t.y:t[1])-this.co.y)/this.dy)*this._RY;return t.v?s.v(e,i):[e,i]}from(t){let e=this.dx*(t.v?t.x:t[0])+this.co.x,i=this.dy*(t.v?t.y:t[1])*this._RY+this.co.y;return t.v?s.v(e,i):[e,i]}},PolarCS:class extends m{constructor(t){super(),this.co=t}to(t){let e=(t.v?t:new s(...t)).sub(this.co),i=e.dist(),r=e.rad();return t.v?s.v(i,r):[i,r]}from(t){let e=t.v?t.x:t[0],i=t.v?t.y:t[1],r=e*Math.sin(i)+this.co.x,h=e*Math.cos(i)+this.co.y;return t.v?s.v(r,h):[r,h]}},RCS:class extends m{constructor(t,s=1){super(),this._co=t,this._scale=s}get scale(){return this._scale}set scale(t){if(t<=0)throw Error(`scale(${t}) must be in (0, Inf)`);this._scale=t}get co(){return this._co.clone()}to(t){let e=((t.v?t.x:t[0])-this._co.x)*this._scale,i=-1*((t.v?t.y:t[1])-this._co.y)*this._scale;return t.v?s.v(e,i):[e,i]}from(t){let e=(t.v?t.x:t[0])/this._scale+this._co.x,i=-1*(t.v?t.y:t[1])/this._scale+this._co.y;return t.v?s.v(e,i):[e,i]}zoom(t){return t>0?this.scale/=Math.abs(t):this.scale*=Math.abs(t),this}move(t){return this._co.add(t.v?t:s.v(...t)),this}}});class y{constructor(t){this.area=t||new v}force(t){}}class w extends y{static G=.01;constructor(t,e=1){super(),this.gp=t||new s(0,0),this.mass=e,this.G=w.G}force(t){if(this.area.in(t.p)){let e=this.gp.dist(t.p),i=s.sub(this.gp,t.p).norm(this.G*(this.mass*t.mass)/e*e);t.force(i)}}static gravity(t,e){let i=s.dist(t.p,e.p),r=w.G*(t.mass*e.mass)/i*i;t.force(s.sub(e.p,t.p).norm(r)),e.force(s.sub(t.p,e.p).norm(r))}}var M=Object.freeze({__proto__:null,AccelerateField:class extends y{constructor(t,s){super(s),this.A=t}force(t){t.force(this.A)}},DecelerateField:class extends y{constructor(t,s){super(s),this._D=-Math.abs(t||.015)}get D(){return this._D}set D(t){this._D=-Math.abs(t)}force(t){this.area.in(t.p)&&t.force(t.v.clone().norm(this.D*t.v.norm()*t.mass))}},DeflectField:class extends y{constructor(t,s){super(s),this.W=t||.017}force(t){this.area.in(t.p)&&t.force(s.sub(t.v.clone().rotate(this.W),t.v))}},Field:y,Gravity:w});class I{constructor(t,{max_pn:s=500,gen_pn:e=1,GENR:i=!1,DSTR:r=!0}={}){this.ps=[],this.particle_builder=t,this.action_middlewares={before:[],after:[]},this.max_pn=s,this.gen_pn=e,this.GENR=i,this.DSTR=r}build(t=0){this.ps=[];for(let s=t<this.max_pn?t:this.max_pn;s--;)this.ps.push(this.particle_builder());return this}particle_action(){let t=[];for(let s=0,e=this.ps.length;s<e;s++)this.ps[s].isEnd()?!this.DSTR&&t.push(this.ps[s]):(this.ps[s].action(),t.push(this.ps[s]));if(this.GENR){let s=this.max_pn-t.length;for(let e=s>=this.gen_pn?this.gen_pn:s;e>0;e--)t.push(this.particle_builder())}this.ps=t}action(){for(let t=0,s=this.action_middlewares.before.length;t<s;t++)this.action_middlewares.before[t](this.ps);this.particle_action();for(let t=0,s=this.action_middlewares.after.length;t<s;t++)this.action_middlewares.after[t](this.ps)}}var R=Object.freeze({__proto__:null,CircularMotorParticle:class extends i{constructor(t,e=1,i=Math.PI/180,r=0){super(),this.o=t||new s(0,0),this.r=e,this.w=i,this.rad=r,this.po=new s(this.r*Math.sin(this.rad),this.r*Math.cos(this.rad)),this.p=s.add(this.po,this.o)}action(){return this._p=this.p.clone(),this.rad+=this.w,this.rad>=2*Math.PI&&(this.rad-=2*Math.PI),this.rad<=-2*Math.PI&&(this.rad+=2*Math.PI),this.po.x=this.r*Math.sin(this.rad),this.po.y=this.r*Math.cos(this.rad),this.p=s.add(this.po,this.o),this.v=this.p.clone().sub(this._p),this.p}},ForceParticle:class extends i{constructor(t,e,i,r){super(),this.p=t||new s(0,0),this.v=e||new s(0,0),this.acc=i||new s(0,0),this.mass=r||1}force(t){this.acc.add(t.clone().mult(1/this.mass))}action(){return this.p.add(this.v.add(this.acc)),this.acc=new s(0,0),this.p}},LinearMotorParticle:class extends i{constructor(t,e,i=1){super(),this._ps=t,this._pe=e,this.p=this._ps.clone(),this.v=s.sub(this._pe,this._ps).norm(Math.abs(i)),this.mode="line",this.end_dist_rate=1.2}get ps(){return this._ps.clone()}get pe(){return this._pe.clone()}set pe(t){this._pe=t.clone(),this.v=s.sub(this._pe,this.p).norm(this.v.norm())}set v_rate(t){this.v.norm(t)}set v_count(t){this.v.norm(s.dist(this._pe,this._ps)/t)}isEnd(){return this.p.dist(this._pe)<=this.v.norm()*this.end_dist_rate}action(){if(this.isEnd())switch(this.mode){case"loop":this.p=this._ps.clone();break;case"back":this.p=this._pe.clone(),this._pe=this._ps.clone(),this._ps=this.p.clone(),this.v.mult(-1);break;default:this.p=this._pe.clone()}else this.p.add(this.v);return this.p}},Particle:i,ParticleSystem:I,RandomWalkerParticle:class extends i{constructor(t,s){super(),this.p=t,this._rvs=this._probability(s)}_probability(t){let e=0;for(let s=0,i=t.length;s<i;s++)e+=t[s][1];let i=[],r=0;for(let h=0,n=t.length;h<n;h++){let n=(t[h][1]||0)/e;i.push({v:t[h][0]||new s(0,0),p:n,ps:r,pe:r+n}),r+=n}return i}rv_select(){let t=Math.random();for(let s=0,e=this._rvs.length;s<e;s++)if(t>this._rvs[s].ps&&t<=this._rvs[s].pe)return this._rvs[s].v}action(){return this.v=this.rv_select(),this.p.add(this.v)}},TrailTracker:class{constructor(t,s=10){this.tp=t,this.tn=s,this.trail=[],this._bind()}_bind(){this.trail=[this.tp.p.clone()];let t=this;this.tp._tracker_hook_action=this.tp.action,this.tp.action=function(){let s=this._tracker_hook_action(...arguments);return t.trail.length>=t.tn&&t.trail.shift(),t.trail.push(s.clone()),s}}},area:f,border:x,coor:b,field:M});class S{constructor(t){this._val=t}val(){return this._val}end(){return!1}tolist(t=500){let s=[];for(let e=0;e<t&&(s.push(this.val()),!this.end());e++);return s}}class P extends S{constructor(t,s,e=1){super(t),this._start=t,this._end=s,this._step=t<s?Math.abs(e):-Math.abs(e)}static S(t,s,e=1){return new P(t,s,e)}static N(t,s,e){return new P(t,s,(s-t)/e)}val(){let t=this._val;return this.end()?this._val=this._end:this._val+=this._step,t}end(){return this._step>0?this._val>this._end:this._val<this._end}clone(){return new P(this._start,this._end,this._step)}}var k=Object.freeze({__proto__:null,FuncIterator:class extends S{constructor(t,s){super(),this.fx=t,this.dod=s.val?s:P.S(...s)}val(t=!1){let s=this.dod.val();return t?[s,this.fx(s)]:this.fx(s)}end(){return this.dod.end()}},Iterator:S,Range:P});class C{static regular_polygon(t,s,e,i=0){e=e||[0,0];let r=2*Math.PI/t,h=[];for(let n=0;n<t;n++)h.push([s*Math.cos(i)+e[0],s*Math.sin(i)+e[1]]),i+=r;return h}static RP(t,s,e,i=0){return C.regular_polygon(t,s,e,i)}static ATR(t){return Math.PI/180*t}static RTA(t){return 180/Math.PI*t}static random(t,s){return(s-t)*Math.random()+t}static rselect(t){return t[parseInt(t.length*Math.random())]}static RGB(t){return`rgb(${t[0]||0}, ${t[1]||0}, ${t[2]||0}, ${t[3]||1})`}}var z=Object.freeze({__proto__:null,RandomSelector:class{constructor(t){this._ops=this._probability(t)}_probability(t){let s=0;for(let e=0,i=t.length;e<i;e++)s+=t[e][1]||0;let e=[],i=0;for(let r=0,h=t.length;r<h;r++){let h=(t[r][1]||0)/s;e.push({op:t[r][0],p:h,ps:i,pe:i+h}),i+=h}return e}select(){let t=Math.random();for(let s=0,e=this._ops.length;s<e;s++)if(t>this._ops[s].ps&&t<=this._ops[s].pe)return this._ops[s].op}},Tools:C,iter:k});class E{constructor(t,s){this.canvasObj=t,this.fileTitle=s||document.getElementsByTagName("title")[0].innerText.replace(/\s+/g,""),this.fn=0,this._capture_keyCode="Q".charCodeAt()}get captureKey(){return String.fromCharCode(this._capture_keyCode)}set captureKey(t){return this._capture_keyCode=t.charCodeAt(),this}capturing(){let t=this;return window.addEventListener("keydown",(function(s){s.keyCode==t._capture_keyCode&&t.capture()})),this}capture(t){t=t||`${this.fileTitle}_${this.fn++}`,this.canvasObj.canvas.toBlob((s=>{let e=document.createElement("a");e.style.display="none",e.id=t,e.href=window.URL.createObjectURL(s),e.download=`${t}.png`,e.click()}))}}class N extends s{constructor(t=0,s=0,e=0,i=1){super(),this.v=1==i?[t,s,e]:[t,s,e,i]}get r(){return this.v[0]}get g(){return this.v[1]}get b(){return this.v[2]}get a(){return this.v[3]}set r(t){this.v[0]=t}set g(t){this.v[1]=t}set b(t){this.v[2]=t}set a(t){this.v[3]=t}color(t=!1){return this.v.length<=3?t?[this.v[0],this.v[1],this.v[2]]:`rgb(${this.v[0]}, ${this.v[1]}, ${this.v[2]})`:t?[this.v[0],this.v[1],this.v[2],this.v[3]]:`rgb(${this.v[0]}, ${this.v[1]}, ${this.v[2]})`}val(t=!1){return this.color(t)}clone(){return new N(...this.v)}}class ${constructor(t,e,i){this.scv=new N(...t),this.ecv=new N(...e),this.cv=this.scv.clone(),this.n=i,this._count=i,this._dcv=s.sub(this.ecv,this.scv).norm(s.dist(this.ecv,this.scv)/i)}color(t=!1){let s=this.cv.color(t);return this._count>0&&this.cv.add(this._dcv),this._count--,s}val(t=!1){return this.color(t)}isEnd(){return!(this._count>0)}}class T{constructor(t=60){this._ft=0,this.fps=t}get ft(){return this._ft}rander(){this._ft++}}var O=Object.freeze({__proto__:null,IntervalRanderer:class extends T{constructor(t=60){super(t),this._stop_ftp=1/0,this._timer=null,this.rander_func=null}rander(t){return this.rander_func=t,this._timer=setInterval((()=>{this._ft<this._stop_ftp?this.rander_func(this._ft++):clearInterval(this._timer)}),Math.ceil(1e3/this.fps)),this}stop(t){return this._stop_ftp=t,this}},SingleFrameRanderer:class extends T{constructor(t=1){super(1),this.act_ft_n=t,this.act_func=null,this.draw_func=null,this._rander_keyCode=" ".charCodeAt()}get randerKey(){return String.fromCharCode(this._rander_keyCode)}set randerKey(t){this._rander_keyCode=t.charCodeAt()}rander(t,s){this.act_func=t,this.draw_func=s;let e=this;return window.addEventListener("keydown",(function(t){if(t.keyCode==e._rander_keyCode){for(let t=0;t<e.act_ft_n;t++)e.act_func(e._ft++);e.draw_func&&e.draw_func(e._ft)}})),this}}});class D{context=null;static nodelink(t,s=[0,100],e=[255,255,255]){let i="number"==typeof s?[0,s]:s,r=i[1]-i[0],h=e.color?e:new N(...e);for(let s=0,e=t.length;s<e;s++){let n=h.color(!0);for(let h=s;h<e;h++){let e=t[s].p.dist(t[h].p);e>=i[0]&&e<=i[1]&&(D.context.ctx.strokeStyle=`rgb(${n[0]}, ${n[1]}, ${n[2]}, ${1-e/r})`,D.context.line(t[s].p,t[h].p))}}}static grid({co:t,dx:e,dy:i,xR:r,yR:h,color:n=[255,255,255],center:l=!0}){t=t||new s(D.context.cx,D.context.cy),i=i||e;let o=(r=r||[-parseInt(D.context.cx/e)-1,parseInt(D.context.cx/e)+1])[0]*e+t.x,a=r[1]*e+t.x,c=(h=h||[-parseInt(D.context.cy/i)-1,parseInt(D.context.cy/i)+1])[0]*i+t.y,d=h[1]*i+t.y,u=l?0:e/2,p=l?0:i/2;D.context.ctx.strokeStyle=`rgb(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]||.25})`;for(let s=r[0],i=r[1];s<=i;s++){let i=s*e+t.x+u;D.context.line(i,c,i,d)}for(let s=h[0],e=h[1];s<=e;s++){let e=s*i+t.y+p;D.context.line(o,e,a,e)}}static lightLine(t,{Lfx:s,n:e=10,d:i=3,cs:r=[255,255,255],ce:h=[0,0,0]}={}){let n=(s=s||(t=>1/(t+1e-4)))(1),l=s(e);D.context.ctx.lineCap="round";for(let o=e;o>0;o--){let e=(s(o)-l)/(n-l),a=[(r[0]-h[0])*e+h[0],(r[1]-h[1])*e+h[1],(r[2]-h[2])*e+h[2]];D.context.ctx.lineWidth=o*i,D.context.lines(t,new $(a,h,t.length))}}static lightRing(t,s,e,{Lfx:i,n:r=50,cs:h=[255,255,255],ce:n=[0,0,0],point:l=!1}={}){i=i||(t=>1/(t+1e-4));let o=i(1),a=i(r),c=e/r;for(let e=r;e>0;e--){let d=(i(l?e:r-e)-a)/(o-a),u=[(h[0]-n[0])*d+n[0],(h[1]-n[1])*d+n[1],(h[2]-n[2])*d+n[2]];D.context.colorStyle=`rgb(${u[0]}, ${u[1]}, ${u[2]})`,D.context.circle(t,s,c*e),D.context.ctx.fill()}}static trail(t,{split_x:s=100,split_y:e=100,color:i="rgb(255, 255, 255)"}={}){let r=[[]];for(let i=0,h=t.length-1;i<h;i++)r[r.length-1].push(t[i]),Math.abs(t[i].x-t[i+1].x)>s|Math.abs(t[i].y-t[i+1].y)>e&&r.push([]);for(let t=0,s=r.length;t<s;t++)r[t].length<=1||D.context.lines(r[t],i)}}var G=Object.freeze({__proto__:null,Capturer:E,ColorGradient:$,ColorVector:N,Views:D,randerer:O});t.Canvas=p,t.Capturer=E,t.Particle=i,t.ParticleSystem=I,t.Tools=C,t.Vector=s,t.Views=D,t.algo=u,t.context=_,t.particle=R,t.randerer=O,t.utils=z,t.vector=e,t.views=G}));
