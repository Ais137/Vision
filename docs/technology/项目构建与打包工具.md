# 项目构建与打包工具

Meta:
* Date : 2023-04-26
* Author : Ais
* Desc : 项目构建与打包工具评估方案

--------------------------------------------------
## 问题场景
Vision项目采用模块化的设计，代码会分散到多个模块文件中，因此需要一个构建和打包工具，将这些分散的模块聚合在一起，打包成一个模块文件供外部调用，同时在打包过程中，需要删除冗余代码和注释来压缩代码体积，以提高通过网络IO时的加载速度。

--------------------------------------------------
## 需求分析
Vision项目对构建和打包工具的核心需求如下(按优先级排序):
1. 支持多种模块标准的导出(ESM，UMD，CJS)。
2. 支持删除冗余代码与注释

--------------------------------------------------
## 技术简介
通过对市面上JavaScript代码构建与打包工具的考察，发现主流的工具有 *webpack* 和 *rollup*。

### webpack
> webpack 是一个用于现代 JavaScript 应用程序的 静态模块打包工具。当 webpack 处理应用程序时，它会在内部从一个或多个入口点构建一个 依赖图(dependency graph)，然后将你项目中所需的每一个模块组合成一个或多个 bundles，它们均为静态资源，用于展示你的内容

### rollup
> Rollup 是一个 JavaScript 模块打包工具，可以将多个小的代码片段编译为完整的库和应用。与传统的 CommonJS 和 AMD 这一类非标准化的解决方案不同，Rollup 使用的是 ES6 版本 Javascript 中的模块标准。新的 ES 模块可以让你自由、无缝地按需使用你最喜爱的库中那些有用的单个函数。这一特性在未来将随处可用，但 Rollup 让你现在就可以，想用就用。

--------------------------------------------------
## 方案评估
经过对 *webpack* 和 *rollup* 方案的综合评估。上述两种方案都可以实现核心需求，但是相对来说 *rollup* 更适合该项目，主要理由如下:
1. Vision项目的核心代码主要是由纯js代码构成的库，而非web应用，不需要对其他类型的资源进行处理。
2. Vision项目采用 *ESM* 模块标准，*rollup* 也是基于 *ESM* 设计的，因此一致性更高。

--------------------------------------------------
## 可行性评估
经过初步的 demo 和实验，已经验证了 *rollup* 方案是可行的。从现有的 *webpack* 迁移到 *rollup* 方案对当前项目结构产生的影响不大，主要涉及到 */build* 目录下的一些构建配置文件。

--------------------------------------------------
## 实施方案
迁移到 *rollup* 方案的具体实施如下:
1. 安装 *rollup* 依赖，并移除 *webpack* 依赖。
2. 添加 *rollup* 所需的配置文件。
3. 弃用 /build/build.js 自动化构建索引文件，采用代码导入的方式构建索引。
4. 更新 npm run build 命令。

